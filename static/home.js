var t=require("showdown"),e=require("string-strip-html");function o(t){return t&&t.__esModule?t.default:t}const a=/(#(?:[^\x00-\x7F]|\w)+)/g,n=/(@(?:[^\x00-\x7F]|\w)+@(?:[^\x00-\x7F]|\w)+\.(?:[^\x00-\x7F]|\w)+)/g,r=t=>[...t.match(n)??[]],c=t=>[...t.match(a)??[]],i=async t=>Object.fromEntries(await Promise.all(t.map((async t=>{const[e,o,a]=t.split("@"),n=await fetch(`/proxy/?resource=https://${a}/.well-known/webfinger?resource=acct:${o}@${a}`,{headers:{Accept:"application/json"}}).then((t=>t.body?t.json():{links:[]}));if(!Array.isArray(n?.links))return[];for(const e of n.links)if("self"===e.rel&&"application/activity+json"===e.type&&e.href)return[t,e.href];return[]})))),s=async(t,e)=>t.replace(a,(t=>`<a href="${new URL(`/tags/${t.toLowerCase().replace("#","")}`,window.location.href).toString()}">${t}</a>`)).replace(n,(t=>{const o=e[t];return o?`<a href="${o}">${t}</a>`:t})),l=window.document.querySelector('form[data-action="edit-profile"]');l?.addEventListener("submit",(async a=>{a.preventDefault();const n=l.getAttribute("action")??"",d=l.getAttribute("data-followers-url")??"",w=l.getAttribute("data-actor-id")??"",u=l?.querySelector('[name="name"]')?.value??"",p=l?.querySelector('[name="summary"]')?.value??"",m=(new(o(t).Converter)).makeHtml(p),h=(0,e.stripHtml)(m).result,g=r(h),y=c(h),b=await i(g),f=[...g.map((t=>{const e=b[t];return e?{type:"Mention",href:e,name:t}:null})).filter((t=>!!t)),...y.map((t=>({type:"Hashtag",name:t})))];fetch(n,{method:"POST",headers:{Accept:"application/activity+json"},body:JSON.stringify({"@context":["https://www.w3.org/ns/activitystreams"],type:"Update",actor:w,to:["https://www.w3.org/ns/activitystreams#Public",d],object:{id:w,name:u,summary:await s(m,b),...f.length?{tag:f}:null}})}).then((t=>{t.headers.get("Location")&&window.location.reload()})).catch((t=>{console.log(t)}))}));const d=window.document.querySelector('form[data-action="upload-icon"]');d?.addEventListener("submit",(t=>{t.preventDefault();const e=d.getAttribute("action")??"",o=d.getAttribute("data-upload-media-endpoint-url")??"",a=d.getAttribute("data-followers-url")??"",n=d.getAttribute("data-actor-id")??"",r=new FormData(d);r.set("object",JSON.stringify({type:"Image"})),fetch(o,{method:"POST",headers:{Accept:"application/activity+json"},body:r}).then((t=>{const o=t.headers.get("Location");o&&fetch(`/proxy?resource=${o}`).then((t=>t.json())).then((({object:t})=>{fetch(e,{method:"POST",headers:{Accept:"application/activity+json"},body:JSON.stringify({"@context":["https://www.w3.org/ns/activitystreams"],type:"Update",actor:n,to:["https://www.w3.org/ns/activitystreams#Public",a],object:{id:n,icon:t}})}).then((t=>{t.headers.get("Location")&&window.location.reload()})).catch((t=>{console.log(t)}))})).catch((t=>{console.log(t)}))})).catch((t=>{console.log(t)}))}));const w=window.document.querySelector('form[data-action="upload-image"]');w?.addEventListener("submit",(t=>{t.preventDefault();const e=w.getAttribute("action")??"",o=w.getAttribute("data-upload-media-endpoint-url")??"",a=w.getAttribute("data-followers-url")??"",n=w.getAttribute("data-actor-id")??"",r=new FormData(w);r.set("object",JSON.stringify({type:"Image"})),fetch(o,{method:"POST",headers:{Accept:"application/activity+json"},body:r}).then((t=>{const o=t.headers.get("Location");o&&fetch(`/proxy/?resource=${o}`).then((t=>t.json())).then((({object:t})=>{fetch(e,{method:"POST",headers:{Accept:"application/activity+json"},body:JSON.stringify({"@context":["https://www.w3.org/ns/activitystreams"],type:"Update",actor:n,to:["https://www.w3.org/ns/activitystreams#Public",a],object:{id:n,image:t}})}).then((t=>{t.headers.get("Location")&&window.location.reload()})).catch((t=>{console.log(t)}))})).catch((t=>{console.log(t)}))})).catch((t=>{console.log(t)}))}));const u=window.document.querySelector('form[data-action="follow"]');u?.addEventListener("submit",(async t=>{t.preventDefault();const e=u.getAttribute("action")??"",o=u.getAttribute("data-followers-url")??"",a=u.getAttribute("data-actor-id")??"",n=u.querySelector('[name="object"]')?.value??"";fetch(e,{method:"POST",headers:{Accept:"application/activity+json"},body:JSON.stringify({"@context":["https://www.w3.org/ns/activitystreams"],type:"Follow",actor:a,to:["https://www.w3.org/ns/activitystreams#Public",o,n],object:n})}).then((t=>{t.headers.get("Location")&&window.location.reload()})).catch((t=>{console.log(t)}))}));const p=window.document.querySelector('[data-action="new-microblog-status"]');p?.addEventListener("submit",(async e=>{e.preventDefault();const a=p.getAttribute("action")??"",n=p.getAttribute("data-followers-url")??"",l=p.getAttribute("data-actor-id")??"",d=p.querySelector('[name="content"]')?.value??"",w=r(d),u=c(d),m=await i(w),h=(new(o(t).Converter)).makeHtml(await s(d,m)),g=[...w.map((t=>{const e=m[t];return e?{type:"Mention",href:e,name:t}:null})).filter((t=>!!t)),...u.map((t=>({type:"Hashtag",name:t})))];fetch(a,{method:"POST",headers:{Accept:"application/activity+json"},body:JSON.stringify({"@context":["https://www.w3.org/ns/activitystreams"],type:"Create",actor:l,to:["https://www.w3.org/ns/activitystreams#Public",n,...Object.values(m)],object:{type:"Note",content:h,...g.length?{tag:g}:null}})}).then((t=>{t.headers.get("Location")&&window.location.reload()})).catch((t=>{console.log(t)}))}));const m=Array.from(window.document.querySelectorAll('[data-action="update-microblog-status"]'));for(const a of m)a?.addEventListener("submit",(async n=>{n.preventDefault();const l=a.getAttribute("action")??"",d=a.getAttribute("data-followers-url")??"",w=a.getAttribute("data-actor-id")??"",u=a.getAttribute("data-object-id")??"",p=a.querySelector('[name="content"]')?.value??"",m=(new(o(t).Converter)).makeHtml(p),h=(0,e.stripHtml)(m).result,g=r(h),y=c(h),b=await i(g),f=[...g.map((t=>{const e=b[t];return e?{type:"Mention",href:e,name:t}:null})).filter((t=>!!t)),...y.map((t=>({type:"Hashtag",name:t})))];fetch(l,{method:"POST",headers:{Accept:"application/activity+json"},body:JSON.stringify({"@context":["https://www.w3.org/ns/activitystreams"],type:"Update",actor:w,to:["https://www.w3.org/ns/activitystreams#Public",d,...Object.values(b)],object:{id:u,content:await s(m,b),...f.length?{tag:f}:null}})}).then((t=>{t.headers.get("Location")&&window.location.reload()})).catch((t=>{console.log(t)}))}));const h=Array.from(window.document.querySelectorAll('[data-action="delete-microblog-status"]'));for(const t of h)t.addEventListener("submit",(e=>{e.preventDefault();const o=t.getAttribute("action")??"",a=t.getAttribute("data-followers-url")??"",n=t.getAttribute("data-actor-id")??"",r=t.getAttribute("data-object-id")??"";fetch(o,{method:"POST",headers:{Accept:"application/activity+json"},body:JSON.stringify({"@context":["https://www.w3.org/ns/activitystreams"],type:"Delete",actor:n,to:["https://www.w3.org/ns/activitystreams#Public",a],object:r})}).then((t=>{t.headers.get("Location")&&window.location.reload()})).catch((t=>{console.log(t)}))}));const g=window.document.querySelector('[data-action="new-blog-post"]');g?.addEventListener("submit",(e=>{e.preventDefault();const a=g.getAttribute("action")??"",n=g.getAttribute("data-followers-url")??"",r=g.getAttribute("data-actor-id")??"",c=g.querySelector('[name="summary"]')?.value??"",i=g.querySelector('[name="content"]')?.value??"",s=(new(o(t).Converter)).makeHtml(i);fetch(a,{method:"POST",headers:{Accept:"application/activity+json"},body:JSON.stringify({"@context":["https://www.w3.org/ns/activitystreams"],type:"Create",actor:r,to:["https://www.w3.org/ns/activitystreams#Public",n],object:{type:"Article",summary:c,content:s,source:{content:i,mediaType:"text/markdown"}}})}).then((t=>{t.headers.get("Location")&&window.location.reload()})).catch((t=>{console.log(t)}))}));const y=Array.from(window.document.querySelectorAll('[data-action="update-blog-post"]'));for(const e of y)e.addEventListener("submit",(a=>{a.preventDefault();const n=e.getAttribute("action")??"",r=e.getAttribute("data-followers-url")??"",c=e.getAttribute("data-actor-id")??"",i=e.getAttribute("data-object-id")??"",s=e.querySelector('[name="summary"]')?.value??"",l=e.querySelector('[name="content"]')?.value??"",d=(new(o(t).Converter)).makeHtml(l);fetch(n,{method:"POST",headers:{Accept:"application/activity+json"},body:JSON.stringify({"@context":["https://www.w3.org/ns/activitystreams"],type:"Update",actor:c,to:["https://www.w3.org/ns/activitystreams#Public",r],object:{id:i,summary:s,content:d}})}).then((t=>{t.headers.get("Location")&&window.location.reload()})).catch((t=>{console.log(t)}))}));const b=Array.from(window.document.querySelectorAll('[data-action="delete-blog-post"]'));for(const t of b)t.addEventListener("submit",(e=>{e.preventDefault();const o=t.getAttribute("action")??"",a=t.getAttribute("data-followers-url")??"",n=t.getAttribute("data-actor-id")??"",r=t.getAttribute("data-object-id")??"";fetch(o,{method:"POST",headers:{Accept:"application/activity+json"},body:JSON.stringify({"@context":["https://www.w3.org/ns/activitystreams"],type:"Delete",actor:n,to:["https://www.w3.org/ns/activitystreams#Public",a],object:r})}).then((t=>{t.headers.get("Location")&&window.location.reload()})).catch((t=>{console.log(t)}))}));const f=Array.from(window.document.querySelectorAll('[data-action="like"]'));for(const t of f)t.addEventListener("submit",(e=>{e.preventDefault();const o=t.getAttribute("action")??"",a=t.getAttribute("data-followers-url")??"",n=t.getAttribute("data-object-actor-id")??"",r=t.getAttribute("data-actor-id")??"",c=t.getAttribute("data-object-id")??"";fetch(o,{method:"POST",headers:{Accept:"application/activity+json"},body:JSON.stringify({"@context":["https://www.w3.org/ns/activitystreams"],type:"Like",actor:r,to:["https://www.w3.org/ns/activitystreams#Public",a,n],object:c})}).then((t=>{t.headers.get("Location")&&window.location.reload()})).catch((t=>{console.log(t)}))}));
//# sourceMappingURL=parcel.046775d2.js.map
